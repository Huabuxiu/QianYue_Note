# 可靠数据传输



## 原理

![TIM截图20180907100917](./TIM截图20180907100917.png)



在不可靠信道上通过协议实现可靠数据传输，应用层只是单向的接受或者发送数据，协议与网络层进行双向的通信，通信内容包括数据可控制信息。



## 在可靠信道上的可靠传输

使用有限状态机来描述接受方和发送方的数据状态。

![TIM截图20180907101332](.\TIM截图20180907101332.png)

发送方：状态：等待上层调用；事件：发送数据；动作：打包数据成分组然后使用可靠信道进行传输

接受方：状态：等待下层调用；事件：接受数据；动作：接受分组然后从分组中提取数据传输给上层。



## 仅会产生位错误的信道进行传输

1. 利用校验和检测数据是否有错误

2. 从错误中恢复

   	确认机制（ACK)：接收方显式的告诉发送方数据正确

   			  NAK：接收方显式的告诉发送方数据错误

   ​	发送方接受到NAK错误信息后从新传送分组。


![TIM截图20180907102130](.\TIM截图20180907102130.png)



发送方：

* 等待上层调用状态，进入事件：接受到接收方的确认信息，而且是正确信息
* 等待ACK或者NAK，进入事件：发送带有检验和的数据或者接受到接受方的错误信息，然后重新发送带有检验和的数据。

接受方：

* 等待下层调用， 进入事件：接受到带有检验和的数据，如果正确发送ACK，如果错误发送NAK。



### 使用序列号和ACK进行确认



![TIM截图20180907121651](.\TIM截图20180907121651.png)

发送方增加了序列号，仅使用ACK来确认最后发送的一个分组，如果传输的ACK损坏就进行重传

